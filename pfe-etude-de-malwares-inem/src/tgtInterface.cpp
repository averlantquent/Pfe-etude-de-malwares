/**
 * @file tgtInterface.cpp
 * @author Damien HEURET
 * @brief fichier qui permet le demarrage et l'arret de programme divers. Par exemple syncbrc.exe
 * @version 0.1
 * @date 2022-01-11
 * 
 * @copyright Copyright (c) 2022
 * 
 */

#include "../include/tgtInterface.h"

/**
 * @brief Construct a new TGTInterface::TGTInterface object
 * 
 * @param execName exe file to be attached to
 * @param isService true if the execName doesn't match filename
 */
TGTInterface::TGTInterface(std::string execName, bool isService)
{
    m_execName = execName;
    m_isService = isService;

    ZeroMemory(&si, sizeof(STARTUPINFO));
    si.cb = sizeof(si);
    si.dwFlags = SYNCHRONIZE;
}


/**
 * @brief Create a new process of the exec passed in constructor.
 * 
 */
void TGTInterface::run() {
    CreateProcess(const_cast<char *>(m_execName.c_str()),
    NULL,
    NULL,
    NULL,
    FALSE,
    NORMAL_PRIORITY_CLASS,
    NULL,
    NULL,
    &si,
    &pi);    
}

/**
 * @brief Terminate that process.
 * 
 */
void TGTInterface::stop() {
    TerminateProcess(pi.hProcess, 0);
}
