#ifndef __CDB_INTERFACE_H_
#define __CDB_INTERFACE_H_

#include <iostream>
#include <windows.h>
#include <string>
#include <regex>
#include <iterator>
#include <sstream>
#include "../include/saveParser.h"
#include <list>

#define CDB_BUFFER_SIZE 4096

class CDBInterface {
    public:
        CDBInterface(std::string attach);
        ~CDBInterface();
        //searchAndSetPID(std::string process);
        void run();
        void stop();
        void send(std::string command);
        std::string recv();
        std::string recv_without_break_condition(bool needDisplay);
        std::string recv_without_break_condition_for_jump(bool needDisplay);
        std::string recv_without_break_condition_for_short_jump(bool needDisplay);
        std::list<std::string> recv_without_break_condition_larger_timeout(bool needDisplay);
        std::string read_register(std::string register_name);
        std::string read_address_for_pop_pop_ret();
        int read_bad_char_output(std::string badCharSended,int rankOfBadChar);
        std::list<std::string> recv_read_narly_output();
        bool recv_without_break_is_bp_failed(bool needDisplay);
        std::string recv_without_break_condition_for_stackbase_and_stacklimit(bool needDisplay);

    private:
        bool isRunning;

        SECURITY_ATTRIBUTES saAttr;

        HANDLE hCDB_IN_rd;
        HANDLE hCDB_IN_wr;
        HANDLE hCDB_OUT_rd;
        HANDLE hCDB_OUT_wr;

        PROCESS_INFORMATION pi;
        STARTUPINFO si;

        std::string cmdLine;
        std::string processToDebug;
        char buffer[CDB_BUFFER_SIZE];
};

#endif //__CDB_INTERFACE_H_